---
title: "Habitat_Model_Multivariat"
format: html
---

# Clear R environment 
```{r}
#clear R environment
rm(list = ls())
```

# Install and load packages 
```{r}
# check for a package, install and load
pkgCheck <- function(x){ 
  if (!require(x,character.only = TRUE)){
    install.packages(x,dependencies=TRUE)
    if(!require(x,character.only = TRUE)) {
      stop()
    }
  }
}

pkgCheck("raster")
pkgCheck("spsurvey")
library(terra)
library(tmap)
library(raster)
library(ggplot2)
```


# 1. Input-Data
## a. Water Depth
```{r}
# Waehlen Sie zuerst einen beliebigen Abfluss sowie eine beliebige Projektvariante und berechnen Sie fuer eine beliebige Altersklasse die entsprechenden univariate Habitateignungsindizes (HSI), der globale Habitateignungsindex (GHSI), das Weighted Usable Area (WUA) Index und das Hydraulic Habitat Suitability (HHS) Index 

# Read raster-files of water depths
depth_path <- "raster_files"

# read raster-files
depth_7 <- raster(file.path(depth_path, "Landquart_results_depth_7.tif"))
depth_3 <- raster(file.path(depth_path, "Landquart_results_depth_3.tif"))
depth_4 <- raster(file.path(depth_path, "Landquart_results_depth_4.tif"))
depth_11 <- raster(file.path(depth_path, "Landquart_results_depth_11.tif"))
depth_13 <- raster(file.path(depth_path, "Landquart_results_depth_13.tif"))
depth_32 <- raster(file.path(depth_path, "Landquart_results_depth_32.tif"))

# Set all 0-cells to NA 
depth_7[depth_7 == 0] <- NA
depth_3[depth_3 == 0] <- NA
depth_4[depth_4 == 0] <- NA
depth_11[depth_11 == 0] <- NA
depth_13[depth_13 == 0] <- NA
depth_32[depth_32 == 0] <- NA

# Plot raster water depths
plot(depth_7, main = "Water depth [m]")
plot(depth_3, main = "Water depth [m]")
plot(depth_4, main = "Water depth [m]")
plot(depth_11, main = "Water depth [m]")
plot(depth_13, main = "Water depth [m]")
plot(depth_32, main = "Water depth [m]")
```

## b. Velocity 
```{r}
# Read raster-files of velocities 
v_path <- "raster_files"

# read raster-files
velocity_7 <- raster(file.path(v_path, "Landquart_results_velocity_7.tif"))
velocity_3 <- raster(file.path(v_path, "Landquart_results_velocity_3.tif"))
velocity_4 <- raster(file.path(v_path, "Landquart_results_velocity_4.tif"))
velocity_11 <- raster(file.path(v_path, "Landquart_results_velocity_11.tif"))
velocity_13 <- raster(file.path(v_path, "Landquart_results_velocity_13.tif"))
velocity_32 <- raster(file.path(v_path, "Landquart_results_velocity_32.tif"))

# Set all 0-cells to NA 
velocity_7[velocity_7 == 0] <- NA
velocity_3[velocity_3 == 0] <- NA
velocity_4[velocity_4 == 0] <- NA
velocity_11[velocity_11 == 0] <- NA
velocity_13[velocity_13 == 0] <- NA
velocity_32[velocity_32 == 0] <- NA

# Plot raster velocities 
plot(velocity_7, main = "Velocity [m/s]")
plot(velocity_3, main = "Velocity [m/s]")
plot(velocity_4, main = "Velocity [m/s]")
plot(velocity_11, main = "Velocity [m/s]")
plot(velocity_13, main = "Velocity [m/s]")
plot(velocity_32, main = "Velocity [m/s]")
```

## c. Substrate
```{r}
# Read raster-file of substrate
sub_path <- "raster_files"

# Read raster-file
sub <- raster(file.path(sub_path, "Landquart_results_substrate.tif"))

# Create a mask of non-NA values with all Q's
mask_7 <- !is.na(depth_7)
mask_3 <- !is.na(depth_3)
mask_4 <- !is.na(depth_4)
mask_11 <- !is.na(depth_11)
mask_13 <- !is.na(depth_13)
mask_32 <- !is.na(depth_32)

# Apply the mask to the raster
depth_masked_7 <- mask(depth_7, mask_7)
depth_masked_3 <- mask(depth_3, mask_3)
depth_masked_4 <- mask(depth_4, mask_4)
depth_masked_11 <- mask(depth_11, mask_11)
depth_masked_13 <- mask(depth_13, mask_13)
depth_masked_32 <- mask(depth_32, mask_32)

# Save the masked raster as a new file
writeRaster(depth_masked_7, "raster_files/depth_masked_7.tif", format="GTiff", overwrite = TRUE)
writeRaster(depth_masked_3, "raster_files/depth_masked_3.tif", format="GTiff", overwrite = TRUE)
writeRaster(depth_masked_4, "raster_files/depth_masked_4.tif", format="GTiff", overwrite = TRUE)
writeRaster(depth_masked_11, "raster_files/depth_masked_11.tif", format="GTiff", overwrite = TRUE)
writeRaster(depth_masked_13, "raster_files/depth_masked_13.tif", format="GTiff", overwrite = TRUE)
writeRaster(depth_masked_32, "raster_files/depth_masked_32.tif", format="GTiff", overwrite = TRUE)

#Plot raster-file of substrate
plot(sub)

# Clip the raster1 with raster2
sub_7 <- mask(sub, depth_masked_7)
sub_3 <- mask(sub, depth_masked_3)
sub_4 <- mask(sub, depth_masked_4)
sub_11 <- mask(sub, depth_masked_11)
sub_13 <- mask(sub, depth_masked_13)
sub_32 <- mask(sub, depth_masked_32)

# plot clipped substrate raster-file
plot(sub_7)
plot(sub_3)
plot(sub_4)
plot(sub_11)
plot(sub_13)
plot(sub_32)

# Save the clipped raster-files as a new file
writeRaster(sub_7, filename="raster_files/substrate_7.tif", format="GTiff", overwrite = TRUE)
writeRaster(sub_3, filename="raster_files/substrate_3.tif", format="GTiff", overwrite = TRUE)
writeRaster(sub_4, filename="raster_files/substrate_4.tif", format="GTiff", overwrite = TRUE)
writeRaster(sub_11, filename="raster_files/substrate_11.tif", format="GTiff", overwrite = TRUE)
writeRaster(sub_13, filename="raster_files/substrate_13.tif", format="GTiff", overwrite = TRUE)
writeRaster(sub_32, filename="raster_files/substrate_32.tif", format="GTiff", overwrite = TRUE)
```


# 2. Habitat modelling 
## a. Suitability Curves 
```{r}
# Read suitability curves 

### WATER DEPTH ###
## Tanno 2012 Rhitrhogena sp.
sc_depth_Tanno_2012_Rhithrogena_path <- "Suitability_Curves_Data/Rhithrogena/Tanno_2012_Rhitrogena_sp_depth_winter.csv" 
sc_depth_Tanno_2012_Rhithrogena <- read.csv(sc_depth_Tanno_2012_Rhithrogena_path, sep=";", dec=".", header = TRUE)
# head(PK_T)

## HABBY Rhitrhogena eaton
sc_depth_HABBY_Rhithrogena_path <- "Suitability_Curves_Data/Rhithrogena/HABBY_Rhitrogena_eaton_larva_depth.csv" 
sc_depth_HABBY_Rhithrogena <- read.csv(sc_depth_HABBY_Rhithrogena_path, sep=";", dec=".", header = TRUE)

## Tanno 2012 Baetis sp.
sc_depth_Tanno_2012_Baetis_path <- "Suitability_Curves_Data/Baetis/Tanno_2012_Baetis_sp_depth_winter.csv" 
sc_depth_Tanno_2012_Baetis <- read.csv(sc_depth_Tanno_2012_Baetis_path, sep=";", dec=".", header = TRUE)

### VELOCITY ###
# Tanno 2012 Rhithrogena sp. 
sc_v_Tanno_2012_Rhithrogena_path <- "Suitability_Curves_Data/Rhithrogena/Tanno_2012_Rhithrogena_sp_velocity_winter.csv" 
sc_v_Tanno_2012_Rhithrogena <- read.csv(sc_v_Tanno_2012_Rhithrogena_path, sep=";", dec=".", header = TRUE)
# head(PK_FG)

# HABBY Rhithrogena eaton 
sc_v_HABBY_Rhithrogena_path <- "Suitability_Curves_Data/Rhithrogena/HABBY_Rhithrogena_eaton_larva_velocity.csv" 
sc_v_HABBY_Rhithrogena <- read.csv(sc_v_HABBY_Rhithrogena_path, sep=";", dec=".", header = TRUE)

# Tanno 2012 Baetis sp. 
sc_v_Tanno_2012_Baetis_path <- "Suitability_Curves_Data/Baetis/Tanno_2012_Baetis_sp_velocity_winter.csv" 
sc_v_Tanno_2012_Baetis <- read.csv(sc_v_Tanno_2012_Baetis_path, sep=";", dec=".", header = TRUE)

### SUBTRATE ###
sc_sub_path <- "Suitability_Curves_Data/Baetis/Tanno_2012_Baetis_sp_substrate_winter.csv" 
sc_sub <- read.csv(sc_sub_path, sep=";", dec=".", header = TRUE)


# Plot suitability curves 
### WATER DEPTH ###
# Tanno 2012 Rhithrogena 
plot(approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "Tanno 2012: Rhithrogena sp. (winter)", col = "black",  lty = 1, lwd = 2, 
     xlab = "Tiefe [m]", ylab = "HS [-]")

# HABBY Rhithrogena 
plot(approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "HABBY: Rhithrogena eaton", col = "black",  lty = 1, lwd = 2, 
     xlab = "Tiefe [m]", ylab = "HS [-]")

# Tanno 2012 Baetis 
plot(approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "Tanno 2012: Baetis sp. (winter)", col = "black",  lty = 1, lwd = 2, 
     xlab = "Tiefe [m]", ylab = "HS [-]")

### VELOCITY ###
# Tanno 2012 Rhithrogena 
plot(approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "Tanno 2012: Rhithrogena sp. (winter)", col = "black",  lty = 1, lwd = 2, 
     xlab = "FG [m/s]", ylab = "HS [-]")

# HABBY Rhithrogena 
plot(approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "HABBY: Rhithrogena eaton", col = "black",  lty = 1, lwd = 2, 
     xlab = "FG [m/s]", ylab = "HS [-]")

# Tanno 2012 Baetis 
plot(approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "Tanno 2012: Baetis sp. (winter)", col = "black",  lty = 1, lwd = 2, 
     xlab = "FG [m/s]", ylab = "HS [-]")

### SUBSTRATE ###
plot(approxfun(sc_sub$Substrate.class, sc_sub$Abundance, method = "linear", rule = 2), xlim = c(0,1.5), 
     main = "Tanno 2012: Baetis sp. (winter)", col = "black",  lty = 1, lwd = 2, 
     xlab = "Substrate class", ylab = "HS [-]")
```


## b. Univariate HM 
### b1. water depth
```{r}
### WATER DEPTH ###
# Tanno 2012 Rhithrogena
# Q7
HS_Tanno_2012_Rhithrogena_depth_7 <- calc(depth_7, fun = approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q3.9
HS_Tanno_2012_Rhithrogena_depth_3 <- calc(depth_3, fun = approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q4.6
HS_Tanno_2012_Rhithrogena_depth_4 <- calc(depth_4, fun = approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q11
HS_Tanno_2012_Rhithrogena_depth_11 <- calc(depth_11, fun = approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q13
HS_Tanno_2012_Rhithrogena_depth_13 <- calc(depth_13, fun = approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q32
HS_Tanno_2012_Rhithrogena_depth_32 <- calc(depth_32, fun = approxfun(sc_depth_Tanno_2012_Rhithrogena$depth..m., sc_depth_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# HABBY Rhithrogena 
# Q7
HS_HABBY_Rhithrogena_depth_7 <- calc(depth_7, fun = approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q3.9
HS_HABBY_Rhithrogena_depth_3 <- calc(depth_3, fun = approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q4.6
HS_HABBY_Rhithrogena_depth_4 <- calc(depth_4, fun = approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q11
HS_HABBY_Rhithrogena_depth_11 <- calc(depth_11, fun = approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q13
HS_HABBY_Rhithrogena_depth_13 <- calc(depth_13, fun = approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q32
HS_HABBY_Rhithrogena_depth_32 <- calc(depth_32, fun = approxfun(sc_depth_HABBY_Rhithrogena$depth..m., sc_depth_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Tanno 2012 Baetis 
# Q7
HS_Tanno_2012_Baetis_depth_7 <- calc(depth_7, fun = approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, rule = 2))

# Q3.9
HS_Tanno_2012_Baetis_depth_3 <- calc(depth_3, fun = approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, rule = 2))

# Q4.6
HS_Tanno_2012_Baetis_depth_4 <- calc(depth_4, fun = approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, rule = 2))

# Q11
HS_Tanno_2012_Baetis_depth_11 <- calc(depth_11, fun = approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, rule = 2))

# Q13
HS_Tanno_2012_Baetis_depth_13 <- calc(depth_13, fun = approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, rule = 2))

# Q32
HS_Tanno_2012_Baetis_depth_32 <- calc(depth_32, fun = approxfun(sc_depth_Tanno_2012_Baetis$depth..m., sc_depth_Tanno_2012_Baetis$Abundance, rule = 2))

# Plot HM regarding depth with different Q's
plot(HS_Tanno_2012_Rhithrogena_depth_7)
plot(HS_Tanno_2012_Rhithrogena_depth_3)
plot(HS_Tanno_2012_Rhithrogena_depth_4)
plot(HS_Tanno_2012_Rhithrogena_depth_11)
plot(HS_Tanno_2012_Rhithrogena_depth_13)
plot(HS_Tanno_2012_Rhithrogena_depth_32)

plot(HS_HABBY_Rhithrogena_depth_7)
plot(HS_HABBY_Rhithrogena_depth_3)
plot(HS_HABBY_Rhithrogena_depth_4)
plot(HS_HABBY_Rhithrogena_depth_11)
plot(HS_HABBY_Rhithrogena_depth_13)
plot(HS_HABBY_Rhithrogena_depth_32)

plot(HS_Tanno_2012_Baetis_depth_7)
plot(HS_Tanno_2012_Baetis_depth_3)
plot(HS_Tanno_2012_Baetis_depth_4)
plot(HS_Tanno_2012_Baetis_depth_11)
plot(HS_Tanno_2012_Baetis_depth_13)
plot(HS_Tanno_2012_Baetis_depth_32)


# set coordinate system (crs)
crs(HS_Tanno_2012_Rhithrogena_depth_7) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_depth_3) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_depth_4) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_depth_11) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_depth_13) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_depth_32) <- "+proj=longlat"

crs(HS_HABBY_Rhithrogena_depth_7) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_depth_3) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_depth_4) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_depth_11) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_depth_13) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_depth_32) <- "+proj=longlat"

crs(HS_Tanno_2012_Baetis_depth_7) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_depth_3) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_depth_4) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_depth_11) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_depth_13) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_depth_32) <- "+proj=longlat"

# save as .tif
# Tanno 2012 Rhithrogena
writeRaster(HS_Tanno_2012_Rhithrogena_depth_7, filename="results_univariate/HS_depth_Tanno_2012_Rhithrogena_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_depth_3, filename="results_univariate/HS_depth_Tanno_2012_Rhithrogena_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_depth_4, filename="results_univariate/HS_depth_Tanno_2012_Rhithrogena_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_depth_11, filename="results_univariate/HS_depth_Tanno_2012_Rhithrogena_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_depth_13, filename="results_univariate/HS_depth_Tanno_2012_Rhithrogena_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_depth_32, filename="results_univariate/HS_depth_Tanno_2012_Rhithrogena_sp_winter_32.tif", format="GTiff", overwrite=TRUE)

# HABBY Rhithrogena 
writeRaster(HS_HABBY_Rhithrogena_depth_7, filename="results_univariate/HS_depth_HABBY_Rhithrogena_eaton_larva_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_depth_3, filename="results_univariate/HS_depth_HABBY_Rhithrogena_eaton_larva_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_depth_4, filename="results_univariate/HS_depth_HABBY_Rhithrogena_eaton_larva_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_depth_11, filename="results_univariate/HS_depth_HABBY_Rhithrogena_eaton_larva_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_depth_13, filename="results_univariate/HS_depth_HABBY_Rhithrogena_eaton_larva_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_depth_32, filename="results_univariate/HS_depth_HABBY_Rhithrogena_eaton_larva_32.tif", format="GTiff", overwrite=TRUE)

# Tanno 2012 Baetis 
writeRaster(HS_Tanno_2012_Baetis_depth_7, filename="results_univariate/HS_depth_Tanno_2012_Baetis_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_depth_3, filename="results_univariate/HS_depth_Tanno_2012_Baetis_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_depth_4, filename="results_univariate/HS_depth_Tanno_2012_Baetis_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_depth_11, filename="results_univariate/HS_depth_Tanno_2012_Baetis_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_depth_13, filename="results_univariate/HS_depth_Tanno_2012_Baetis_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_depth_32, filename="results_univariate/HS_depth_Tanno_2012_Baetis_sp_winter_32.tif", format="GTiff", overwrite=TRUE)
```

### b2. velocity
```{r}
### VELOCITY ###
# Tanno 2012 Rhithrogena
# Q7
HS_Tanno_2012_Rhithrogena_velocity_7 <- calc(velocity_7, fun = approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, rule = 2)) 

# Q3.9
HS_Tanno_2012_Rhithrogena_velocity_3 <- calc(velocity_3, fun = approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q4.6
HS_Tanno_2012_Rhithrogena_velocity_4 <- calc(velocity_4, fun = approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q11
HS_Tanno_2012_Rhithrogena_velocity_11 <- calc(velocity_11, fun = approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q13.3
HS_Tanno_2012_Rhithrogena_velocity_13 <- calc(velocity_13, fun = approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# Q32.69
HS_Tanno_2012_Rhithrogena_velocity_32 <- calc(velocity_32, fun = approxfun(sc_v_Tanno_2012_Rhithrogena$Velocity..m.s., sc_v_Tanno_2012_Rhithrogena$Abundance, rule = 2))

# HABBY Rhithrogena
# Q7
HS_HABBY_Rhithrogena_velocity_7 <- calc(velocity_7, fun = approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, rule = 2))

# Q3.9
HS_HABBY_Rhithrogena_velocity_3 <- calc(velocity_3, fun = approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q4.6
HS_HABBY_Rhithrogena_velocity_4 <- calc(velocity_4, fun = approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q11
HS_HABBY_Rhithrogena_velocity_11 <- calc(velocity_11, fun = approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q13.3
HS_HABBY_Rhithrogena_velocity_13 <- calc(velocity_13, fun = approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Q32.69
HS_HABBY_Rhithrogena_velocity_32 <- calc(velocity_32, fun = approxfun(sc_v_HABBY_Rhithrogena$Velocity..m.s., sc_v_HABBY_Rhithrogena$Abundance, rule = 2)) 

# Tanno 2012 Baetis
# Q7
HS_Tanno_2012_Baetis_velocity_7 <- calc(velocity_7, fun = approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, rule = 2))

# Q3.9
HS_Tanno_2012_Baetis_velocity_3 <- calc(velocity_3, fun = approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, rule = 2))

# Q4.6
HS_Tanno_2012_Baetis_velocity_4 <- calc(velocity_4, fun = approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, rule = 2))

# Q11
HS_Tanno_2012_Baetis_velocity_11 <- calc(velocity_11, fun = approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, rule = 2))

# Q13.3
HS_Tanno_2012_Baetis_velocity_13 <- calc(velocity_13, fun = approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, rule = 2))

# Q32.69
HS_Tanno_2012_Baetis_velocity_32 <- calc(velocity_32, fun = approxfun(sc_v_Tanno_2012_Baetis$Velocity..m.s., sc_v_Tanno_2012_Baetis$Abundance, rule = 2))

# Plot habitat suitability regarding velocities 
plot(HS_Tanno_2012_Rhithrogena_velocity_7)
plot(HS_Tanno_2012_Rhithrogena_velocity_3)
plot(HS_Tanno_2012_Rhithrogena_velocity_4)
plot(HS_Tanno_2012_Rhithrogena_velocity_11)
plot(HS_Tanno_2012_Rhithrogena_velocity_13)
plot(HS_Tanno_2012_Rhithrogena_velocity_32)

plot(HS_HABBY_Rhithrogena_velocity_7)
plot(HS_HABBY_Rhithrogena_velocity_3)
plot(HS_HABBY_Rhithrogena_velocity_4)
plot(HS_HABBY_Rhithrogena_velocity_11)
plot(HS_HABBY_Rhithrogena_velocity_13)
plot(HS_HABBY_Rhithrogena_velocity_32)

plot(HS_Tanno_2012_Baetis_velocity_7)
plot(HS_Tanno_2012_Baetis_velocity_3)
plot(HS_Tanno_2012_Baetis_velocity_4)
plot(HS_Tanno_2012_Baetis_velocity_11)
plot(HS_Tanno_2012_Baetis_velocity_13)
plot(HS_Tanno_2012_Baetis_velocity_32)


#Koordinatensystem (crs)
crs(HS_Tanno_2012_Rhithrogena_velocity_7) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_velocity_3) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_velocity_4) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_velocity_11) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_velocity_13) <- "+proj=longlat"
crs(HS_Tanno_2012_Rhithrogena_velocity_32) <- "+proj=longlat"

crs(HS_HABBY_Rhithrogena_velocity_7) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_velocity_3) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_velocity_4) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_velocity_11) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_velocity_13) <- "+proj=longlat"
crs(HS_HABBY_Rhithrogena_velocity_32) <- "+proj=longlat"

crs(HS_Tanno_2012_Baetis_velocity_7) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_velocity_3) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_velocity_4) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_velocity_11) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_velocity_13) <- "+proj=longlat"
crs(HS_Tanno_2012_Baetis_velocity_32) <- "+proj=longlat"

# save as .tif
# Tanno 2012: Rhithrogena
writeRaster(HS_Tanno_2012_Rhithrogena_velocity_7, filename="results_univariate/HS_velocity_Tanno_2012_Rhithrogena_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_velocity_3, filename="results_univariate/HS_velocity_Tanno_2012_Rhithrogena_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_velocity_4, filename="results_univariate/HS_velocity_Tanno_2012_Rhithrogena_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_velocity_11, filename="results_univariate/HS_velocity_Tanno_2012_Rhithrogena_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_velocity_13, filename="results_univariate/HS_velocity_Tanno_2012_Rhithrogena_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Rhithrogena_velocity_32, filename="results_univariate/HS_velocity_Tanno_2012_Rhithrogena_sp_winter_32.tif", format="GTiff", overwrite=TRUE)

# HABBY Rhithrogena 
writeRaster(HS_HABBY_Rhithrogena_velocity_7, filename="results_univariate/HS_velocity_HABBY_Rhithrogena_eaton_larva_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_velocity_3, filename="results_univariate/HS_velocity_HABBY_Rhithrogena_eaton_larva_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_velocity_4, filename="results_univariate/HS_velocity_HABBY_Rhithrogena_eaton_larva_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_velocity_11, filename="results_univariate/HS_velocity_HABBY_Rhithrogena_eaton_larva_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_velocity_13, filename="results_univariate/HS_velocity_HABBY_Rhithrogena_eaton_larva_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_HABBY_Rhithrogena_velocity_32, filename="results_univariate/HS_velocity_HABBY_Rhithrogena_eaton_larva_32.tif", format="GTiff", overwrite=TRUE)

# Tanno 2012 Baetis 
writeRaster(HS_Tanno_2012_Baetis_velocity_7, filename="results_univariate/HS_velocity_Tanno_2012_Baetis_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_velocity_3, filename="results_univariate/HS_velocity_Tanno_2012_Baetis_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_velocity_4, filename="results_univariate/HS_velocity_Tanno_2012_Baetis_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_velocity_11, filename="results_univariate/HS_velocity_Tanno_2012_Baetis_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_velocity_13, filename="results_univariate/HS_velocity_Tanno_2012_Baetis_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_Tanno_2012_Baetis_velocity_32, filename="results_univariate/HS_velocity_Tanno_2012_Baetis_sp_winter_32.tif", format="GTiff", overwrite=TRUE)
```


### b3. substrate
```{r}
# Substrate (Sub)
# Tanno 2012: Baetis sp.
# Q7
HS_sub_7 <- calc(sub_7, fun = approxfun(sc_sub$Substrate.class, sc_sub$Abundance, rule = 2)) 

# Q3.9
HS_sub_3 <- calc(sub_3, fun = approxfun(sc_sub$Substrate.class, sc_sub$Abundance, rule = 2)) 

# Q4.6
HS_sub_4 <- calc(sub_4, fun = approxfun(sc_sub$Substrate.class, sc_sub$Abundance, rule = 2)) 

# Q11
HS_sub_11 <- calc(sub_11, fun = approxfun(sc_sub$Substrate.class, sc_sub$Abundance, rule = 2)) 

# Q13.3
HS_sub_13 <- calc(sub_13, fun = approxfun(sc_sub$Substrate.class, sc_sub$Abundance, rule = 2)) 

# Q32.69
HS_sub_32 <- calc(sub_32, fun = approxfun(sc_sub$Substrate.class, sc_sub$Abundance, rule = 2)) 


#Plot Habitateignung in Bezug auf Tiefe
plot(HS_sub_7)
plot(HS_sub_3)
plot(HS_sub_4)
plot(HS_sub_11)
plot(HS_sub_13)
plot(HS_sub_32)


# Koordinatensystem (crs)
crs(HS_sub_7) <- "+proj=longlat"
crs(HS_sub_3) <- "+proj=longlat"
crs(HS_sub_4) <- "+proj=longlat"
crs(HS_sub_11) <- "+proj=longlat"
crs(HS_sub_13) <- "+proj=longlat"
crs(HS_sub_32) <- "+proj=longlat"

# save as .tif
writeRaster(HS_sub_7, filename="results_univariate/HS_sub_Baetis_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_sub_3, filename="results_univariate/HS_sub_Baetis_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_sub_4, filename="results_univariate/HS_sub_Baetis_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_sub_11, filename="results_univariate/HS_sub_Baetis_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_sub_13, filename="results_univariate/HS_sub_Baetis_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(HS_sub_32, filename="results_univariate/HS_sub_Baetis_sp_winter_32.tif", format="GTiff", overwrite=TRUE)
```


## c. GHSI Habitateignungsindex 
```{r}
### GHSI ###
# Tanno 2012 Rhithrogena
# Q7
GHSI_Tanno_2012_Rhithrogena_7 <- overlay(HS_Tanno_2012_Rhithrogena_depth_7, HS_Tanno_2012_Rhithrogena_velocity_7, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q3.9
GHSI_Tanno_2012_Rhithrogena_3 <- overlay(HS_Tanno_2012_Rhithrogena_depth_3, HS_Tanno_2012_Rhithrogena_velocity_3, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q4.6
GHSI_Tanno_2012_Rhithrogena_4 <- overlay(HS_Tanno_2012_Rhithrogena_depth_4, HS_Tanno_2012_Rhithrogena_velocity_4, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q11
GHSI_Tanno_2012_Rhithrogena_11 <- overlay(HS_Tanno_2012_Rhithrogena_depth_11, HS_Tanno_2012_Rhithrogena_velocity_11, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q13.3
GHSI_Tanno_2012_Rhithrogena_13 <- overlay(HS_Tanno_2012_Rhithrogena_depth_13, HS_Tanno_2012_Rhithrogena_velocity_13, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q32.69
GHSI_Tanno_2012_Rhithrogena_32 <- overlay(HS_Tanno_2012_Rhithrogena_depth_32, HS_Tanno_2012_Rhithrogena_velocity_32, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# HABBY Rhithrogena
# Q7
GHSI_HABBY_Rhithrogena_7 <- overlay(HS_HABBY_Rhithrogena_depth_7, HS_HABBY_Rhithrogena_velocity_7, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q3.9
GHSI_HABBY_Rhithrogena_3 <- overlay(HS_HABBY_Rhithrogena_depth_3, HS_HABBY_Rhithrogena_velocity_3, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q4.6
GHSI_HABBY_Rhithrogena_4 <- overlay(HS_HABBY_Rhithrogena_depth_4, HS_HABBY_Rhithrogena_velocity_4, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q11
GHSI_HABBY_Rhithrogena_11 <- overlay(HS_HABBY_Rhithrogena_depth_11, HS_HABBY_Rhithrogena_velocity_11, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q13.3
GHSI_HABBY_Rhithrogena_13 <- overlay(HS_HABBY_Rhithrogena_depth_13, HS_HABBY_Rhithrogena_velocity_13, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Q32.69
GHSI_HABBY_Rhithrogena_32 <- overlay(HS_HABBY_Rhithrogena_depth_32, HS_HABBY_Rhithrogena_velocity_32, fun = function(r1, r2){return(sqrt(r1^2*r2^2))})

# Tanno 2012 Baetis (+ sub)
# Q7
GHSI_Tanno_2012_Baetis_7 <- overlay(HS_Tanno_2012_Baetis_depth_7, HS_Tanno_2012_Baetis_velocity_7, HS_sub_7, fun = function(r1, r2, r3){return(sqrt(r1^3*r2^3*r3^3))})

# Q3.9
GHSI_Tanno_2012_Baetis_3 <- overlay(HS_Tanno_2012_Baetis_depth_3, HS_Tanno_2012_Baetis_velocity_3, HS_sub_3, fun = function(r1, r2, r3){return(sqrt(r1^3*r2^3*r3^3))})

# Q4.6
GHSI_Tanno_2012_Baetis_4 <- overlay(HS_Tanno_2012_Baetis_depth_4, HS_Tanno_2012_Baetis_velocity_4, HS_sub_4, fun = function(r1, r2, r3){return(sqrt(r1^3*r2^3*r3^3))})

# Q11
GHSI_Tanno_2012_Baetis_11 <- overlay(HS_Tanno_2012_Baetis_depth_11, HS_Tanno_2012_Baetis_velocity_11, HS_sub_11, fun = function(r1, r2, r3){return(sqrt(r1^3*r2^3*r3^3))})

# Q13.3
GHSI_Tanno_2012_Baetis_13 <- overlay(HS_Tanno_2012_Baetis_depth_13, HS_Tanno_2012_Baetis_velocity_13, HS_sub_13, fun = function(r1, r2, r3){return(sqrt(r1^3*r2^3*r3^3))})

# Q32.69
GHSI_Tanno_2012_Baetis_32 <- overlay(HS_Tanno_2012_Baetis_depth_32, HS_Tanno_2012_Baetis_velocity_32, HS_sub_32, fun = function(r1, r2, r3){return(sqrt(r1^3*r2^3*r3^3))})


### Plot GHSI ###
plot(GHSI_Tanno_2012_Rhithrogena_7)
plot(GHSI_Tanno_2012_Rhithrogena_3)
plot(GHSI_Tanno_2012_Rhithrogena_4)
plot(GHSI_Tanno_2012_Rhithrogena_11)
plot(GHSI_Tanno_2012_Rhithrogena_13)
plot(GHSI_Tanno_2012_Rhithrogena_32)

plot(GHSI_HABBY_Rhithrogena_7)
plot(GHSI_HABBY_Rhithrogena_3)
plot(GHSI_HABBY_Rhithrogena_4)
plot(GHSI_HABBY_Rhithrogena_11)
plot(GHSI_HABBY_Rhithrogena_13)
plot(GHSI_HABBY_Rhithrogena_32)

plot(GHSI_Tanno_2012_Baetis_7)
plot(GHSI_Tanno_2012_Baetis_3)
plot(GHSI_Tanno_2012_Baetis_4)
plot(GHSI_Tanno_2012_Baetis_11)
plot(GHSI_Tanno_2012_Baetis_13)
plot(GHSI_Tanno_2012_Baetis_32)
```


```{r}
# Erstelle Haeufigkeitstabelle #????????
# Tanno 2012: Rhithrogena 
# Q7
freq_GHSI_Tanno_2012_Rhithrogena_7 <- as.data.frame(freq(GHSI_Tanno_2012_Rhithrogena_7, digit=1, useNA= "no")) 

# Q3.9
freq_GHSI_Tanno_2012_Rhithrogena_3 <- as.data.frame(freq(GHSI_Tanno_2012_Rhithrogena_3, digit=1, useNA= "no")) 

# Q4.6
freq_GHSI_Tanno_2012_Rhithrogena_4 <- as.data.frame(freq(GHSI_Tanno_2012_Rhithrogena_4, digit=1, useNA= "no")) 

# Q11
freq_GHSI_Tanno_2012_Rhithrogena_11 <- as.data.frame(freq(GHSI_Tanno_2012_Rhithrogena_11, digit=1, useNA= "no")) 

# Q13.3
freq_GHSI_Tanno_2012_Rhithrogena_13 <- as.data.frame(freq(GHSI_Tanno_2012_Rhithrogena_13, digit=1, useNA= "no")) 

# Q32.69
freq_GHSI_Tanno_2012_Rhithrogena_32 <- as.data.frame(freq(GHSI_Tanno_2012_Rhithrogena_32, digit=1, useNA= "no")) 

# HABBY Rhithrogena 
# Q7
freq_GHSI_HABBY_Rhithrogena_7 <- as.data.frame(freq(GHSI_HABBY_Rhithrogena_7, digit=1, useNA= "no")) 
# Q3.9
freq_GHSI_HABBY_Rhithrogena_3 <- as.data.frame(freq(GHSI_HABBY_Rhithrogena_3, digit=1, useNA= "no"))

# Q4.6
freq_GHSI_HABBY_Rhithrogena_4 <- as.data.frame(freq(GHSI_HABBY_Rhithrogena_4, digit=1, useNA= "no"))

# Q11
freq_GHSI_HABBY_Rhithrogena_11 <- as.data.frame(freq(GHSI_HABBY_Rhithrogena_11, digit=1, useNA= "no"))

# Q13.3
freq_GHSI_HABBY_Rhithrogena_13 <- as.data.frame(freq(GHSI_HABBY_Rhithrogena_13, digit=1, useNA= "no"))

# Q32.69
freq_GHSI_HABBY_Rhithrogena_32 <- as.data.frame(freq(GHSI_HABBY_Rhithrogena_32, digit=1, useNA= "no"))

# Tanno 2012 Baetis sp.
# Q7
freq_GHSI_Tanno_2012_Baetis_7 <- as.data.frame(freq(GHSI_Tanno_2012_Baetis_7, digit=1, useNA= "no")) 
# Q3.9
freq_GHSI_Tanno_2012_Baetis_3 <- as.data.frame(freq(GHSI_Tanno_2012_Baetis_3, digit=1, useNA= "no"))

# Q4.6
freq_GHSI_Tanno_2012_Baetis_4 <- as.data.frame(freq(GHSI_Tanno_2012_Baetis_4, digit=1, useNA= "no"))

# Q11
freq_GHSI_Tanno_2012_Baetis_11 <- as.data.frame(freq(GHSI_Tanno_2012_Baetis_11, digit=1, useNA= "no"))

# Q13.3
freq_GHSI_Tanno_2012_Baetis_13 <- as.data.frame(freq(GHSI_Tanno_2012_Baetis_13, digit=1, useNA= "no"))

# Q32.69
freq_GHSI_Tanno_2012_Baetis_32 <- as.data.frame(freq(GHSI_Tanno_2012_Baetis_32, digit=1, useNA= "no"))

# save as .tif
# Tanno 2012: Rhithrogena
writeRaster(GHSI_Tanno_2012_Rhithrogena_7, filename="results_multivariate/GHSI_Tanno_2012_Rhithrogena_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Rhithrogena_3, filename="results_multivariate/GHSI_Tanno_2012_Rhithrogena_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Rhithrogena_4, filename="results_multivariate/GHSI_Tanno_2012_Rhithrogena_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Rhithrogena_11, filename="results_multivariate/GHSI_Tanno_2012_Rhithrogena_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Rhithrogena_13, filename="results_multivariate/GHSI_Tanno_2012_Rhithrogena_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Rhithrogena_32, filename="results_multivariate/GHSI_Tanno_2012_Rhithrogena_sp_winter_32.tif", format="GTiff", overwrite=TRUE)

# HABBY Rhithrogena 
writeRaster(GHSI_HABBY_Rhithrogena_7, filename="results_multivariate/GHSI_HABBY_Rhithrogena_eaton_larva_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_HABBY_Rhithrogena_3, filename="results_multivariate/GHSI_HABBY_Rhithrogena_eaton_larva_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_HABBY_Rhithrogena_4, filename="results_multivariate/GHSI_HABBY_Rhithrogena_eaton_larva_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_HABBY_Rhithrogena_11, filename="results_multivariate/GHSI_HABBY_Rhithrogena_eaton_larva_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_HABBY_Rhithrogena_13, filename="results_multivariate/GHSI_HABBY_Rhithrogena_eaton_larva_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_HABBY_Rhithrogena_32, filename="results_multivariate/GHSI_HABBY_Rhithrogena_eaton_larva_32.tif", format="GTiff", overwrite=TRUE)

# Tanno 2012 Baetis sp. 
writeRaster(GHSI_Tanno_2012_Baetis_7, filename="results_multivariate/GHSI_Tanno_2012_Baetis_sp_winter_7.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Baetis_3, filename="results_multivariate/GHSI_Tanno_2012_Baetis_sp_winter_3.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Baetis_4, filename="results_multivariate/GHSI_Tanno_2012_Baetis_sp_winter_4.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Baetis_11, filename="results_multivariate/GHSI_Tanno_2012_Baetis_sp_winter_11.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Baetis_13, filename="results_multivariate/GHSI_Tanno_2012_Baetis_sp_winter_13.tif", format="GTiff", overwrite=TRUE)

writeRaster(GHSI_Tanno_2012_Baetis_32, filename="results_multivariate/GHSI_Tanno_2012_Baetis_sp_winter_32.tif", format="GTiff", overwrite=TRUE)
```


## e. Weigthed Usable Area [m2]
```{r}
# Tanno 2012: Rhithrogena 
# Q7
WUA_Tanno_2012_Rhithrogena_7 <- cellStats(GHSI_Tanno_2012_Rhithrogena_7, 'sum') * 4

# Q3.9
WUA_Tanno_2012_Rhithrogena_3 <- cellStats(GHSI_Tanno_2012_Rhithrogena_3, 'sum') * 4

# Q4.6
WUA_Tanno_2012_Rhithrogena_4 <- cellStats(GHSI_Tanno_2012_Rhithrogena_4, 'sum') * 4

# Q11
WUA_Tanno_2012_Rhithrogena_11 <- cellStats(GHSI_Tanno_2012_Rhithrogena_11, 'sum') * 4

# Q13.3
WUA_Tanno_2012_Rhithrogena_13 <- cellStats(GHSI_Tanno_2012_Rhithrogena_13, 'sum') * 4

# Q32.69
WUA_Tanno_2012_Rhithrogena_32 <- cellStats(GHSI_Tanno_2012_Rhithrogena_32, 'sum') * 4

# HABBY Rhithrogena 
# Q7
WUA_HABBY_Rhithrogena_7 <- cellStats(GHSI_HABBY_Rhithrogena_7, 'sum') * 4

# Q3.9
WUA_HABBY_Rhithrogena_3 <- cellStats(GHSI_HABBY_Rhithrogena_3, 'sum') * 4

# Q4.6
WUA_HABBY_Rhithrogena_4 <- cellStats(GHSI_HABBY_Rhithrogena_4, 'sum') * 4

# Q11
WUA_HABBY_Rhithrogena_11 <- cellStats(GHSI_HABBY_Rhithrogena_11, 'sum') * 4

# Q13.3
WUA_HABBY_Rhithrogena_13 <- cellStats(GHSI_HABBY_Rhithrogena_13, 'sum') * 4

# Q32.69
WUA_HABBY_Rhithrogena_32 <- cellStats(GHSI_HABBY_Rhithrogena_32, 'sum') * 4

# Tanno 2012: Baetis sp. 
# Q7 
WUA_Tanno_2012_Baetis_7 <- cellStats(GHSI_Tanno_2012_Baetis_7, 'sum') * 4

# Q3.9
WUA_Tanno_2012_Baetis_3 <- cellStats(GHSI_Tanno_2012_Baetis_3, 'sum') * 4

# Q4.6
WUA_Tanno_2012_Baetis_4 <- cellStats(GHSI_Tanno_2012_Baetis_4, 'sum') * 4

# Q11
WUA_Tanno_2012_Baetis_11 <- cellStats(GHSI_Tanno_2012_Baetis_11, 'sum') * 4

# Q13.3
WUA_Tanno_2012_Baetis_13 <- cellStats(GHSI_Tanno_2012_Baetis_13, 'sum') * 4

# Q32.69
WUA_Tanno_2012_Baetis_32 <- cellStats(GHSI_Tanno_2012_Baetis_32, 'sum') * 4
```

## f. Wetted Area [m2]
```{r}
# Tanno 2012: Rhithrogena
# Q7
WA_tot_Tanno_2012_Rhithrogena_7 <- sum(freq_GHSI_Tanno_2012_Rhithrogena_7$count) * 4

# Q3.9
WA_tot_Tanno_2012_Rhithrogena_3 <- sum(freq_GHSI_Tanno_2012_Rhithrogena_3$count) * 4

# Q4.6
WA_tot_Tanno_2012_Rhithrogena_4 <- sum(freq_GHSI_Tanno_2012_Rhithrogena_4$count) * 4

# Q11
WA_tot_Tanno_2012_Rhithrogena_11 <- sum(freq_GHSI_Tanno_2012_Rhithrogena_11$count) * 4

# Q13.3
WA_tot_Tanno_2012_Rhithrogena_13 <- sum(freq_GHSI_Tanno_2012_Rhithrogena_13$count) * 4

# Q32.69
WA_tot_Tanno_2012_Rhithrogena_32 <- sum(freq_GHSI_Tanno_2012_Rhithrogena_32$count) * 4

# HABBY Rhithrogena 
# Q7
WA_tot_HABBY_Rhithrogena_7 <- sum(freq_GHSI_HABBY_Rhithrogena_7$count) * 4

# Q3.9
WA_tot_HABBY_Rhithrogena_3 <- sum(freq_GHSI_HABBY_Rhithrogena_3$count) * 4

# Q4.6
WA_tot_HABBY_Rhithrogena_4 <- sum(freq_GHSI_HABBY_Rhithrogena_4$count) * 4

# Q11
WA_tot_HABBY_Rhithrogena_11 <- sum(freq_GHSI_HABBY_Rhithrogena_11$count) * 4

# Q13.3
WA_tot_HABBY_Rhithrogena_13 <- sum(freq_GHSI_HABBY_Rhithrogena_13$count) * 4

# Q32.69
WA_tot_HABBY_Rhithrogena_32 <- sum(freq_GHSI_HABBY_Rhithrogena_32$count) * 4

# Tanno 2012: Baetis sp.
# Q7
WA_tot_Tanno_2012_Baetis_7 <- sum(freq_GHSI_Tanno_2012_Baetis_7$count) * 4

# Q3.9
WA_tot_Tanno_2012_Baetis_3 <- sum(freq_GHSI_Tanno_2012_Baetis_3$count) * 4

# Q4.6
WA_tot_Tanno_2012_Baetis_4 <- sum(freq_GHSI_Tanno_2012_Baetis_4$count) * 4

# Q11
WA_tot_Tanno_2012_Baetis_11 <- sum(freq_GHSI_Tanno_2012_Baetis_11$count) * 4

# Q13.3
WA_tot_Tanno_2012_Baetis_13 <- sum(freq_GHSI_Tanno_2012_Baetis_13$count) * 4

# Q32.69
WA_tot_Tanno_2012_Baetis_32 <- sum(freq_GHSI_Tanno_2012_Baetis_32$count) * 4
```

## g. Hydraulik Habitat Suitability [-]
```{r}
# Tanno 2012: Rhithrogena 
# Q7
HHS_Tanno_2012_Rhithrogena_7 <- WUA_Tanno_2012_Rhithrogena_7/WA_tot_Tanno_2012_Rhithrogena_7

# Q3.9
HHS_Tanno_2012_Rhithrogena_3 <- WUA_Tanno_2012_Rhithrogena_3/WA_tot_Tanno_2012_Rhithrogena_3

# Q4.6
HHS_Tanno_2012_Rhithrogena_4 <- WUA_Tanno_2012_Rhithrogena_4/WA_tot_Tanno_2012_Rhithrogena_4

# Q11
HHS_Tanno_2012_Rhithrogena_11 <- WUA_Tanno_2012_Rhithrogena_11/WA_tot_Tanno_2012_Rhithrogena_11

# Q13.3
HHS_Tanno_2012_Rhithrogena_13 <- WUA_Tanno_2012_Rhithrogena_13/WA_tot_Tanno_2012_Rhithrogena_13

# Q32.69
HHS_Tanno_2012_Rhithrogena_32 <- WUA_Tanno_2012_Rhithrogena_32/WA_tot_Tanno_2012_Rhithrogena_32


# HABBY Rhithrogena 
# Q7
HHS_HABBY_Rhithrogena_7 <- WUA_HABBY_Rhithrogena_7/WA_tot_HABBY_Rhithrogena_7

# Q3.9
HHS_HABBY_Rhithrogena_3 <- WUA_HABBY_Rhithrogena_3/WA_tot_HABBY_Rhithrogena_3

# Q4.6
HHS_HABBY_Rhithrogena_4 <- WUA_HABBY_Rhithrogena_4/WA_tot_HABBY_Rhithrogena_4

# Q11
HHS_HABBY_Rhithrogena_11 <- WUA_HABBY_Rhithrogena_11/WA_tot_HABBY_Rhithrogena_11

# Q13.3
HHS_HABBY_Rhithrogena_13 <- WUA_HABBY_Rhithrogena_13/WA_tot_HABBY_Rhithrogena_13

# Q32.69
HHS_HABBY_Rhithrogena_32 <- WUA_HABBY_Rhithrogena_32/WA_tot_HABBY_Rhithrogena_32

# Tanno 2012: Baetis sp.
# Q7
HHS_Tanno_2012_Baetis_7 <- WUA_Tanno_2012_Baetis_7/WA_tot_Tanno_2012_Baetis_7

# Q3.9
HHS_Tanno_2012_Baetis_3 <- WUA_Tanno_2012_Baetis_3/WA_tot_Tanno_2012_Baetis_3

# Q4.6
HHS_Tanno_2012_Baetis_4 <- WUA_Tanno_2012_Baetis_4/WA_tot_Tanno_2012_Baetis_4

# Q11
HHS_Tanno_2012_Baetis_11 <- WUA_Tanno_2012_Baetis_11/WA_tot_Tanno_2012_Baetis_11

# Q13.3
HHS_Tanno_2012_Baetis_13 <- WUA_Tanno_2012_Baetis_13/WA_tot_Tanno_2012_Baetis_13

# Q32.69
HHS_Tanno_2012_Baetis_32 <- WUA_Tanno_2012_Baetis_32/WA_tot_Tanno_2012_Baetis_32
```


# 4. make dataframe and .csv of calculated indices 
```{r}
# data frame WUA and HHS 
results <- data.frame(Description = c("Tanno 2012 Baetis sp.", "Tanno 2012 Baetis sp.", "Tanno 2012 Baetis sp.", "Tanno 2012 Baetis sp.", "Tanno 2012 Baetis sp.", "Tanno 2012 Baetis sp.", "Tanno 2012 Rhithrogena sp.", "Tanno 2012 Rhithrogena sp.", "Tanno 2012 Rhithrogena sp.", "Tanno 2012 Rhithrogena sp.", "Tanno 2012 Rhithrogena sp.", "Tanno 2012 Rhithrogena sp.",  "HABBY Rhithrogena eaton larva", "HABBY Rhithrogena eaton larva", "HABBY Rhithrogena eaton larva", "HABBY Rhithrogena eaton larva", "HABBY Rhithrogena eaton larva", "HABBY Rhithrogena eaton larva"), Discharge = c(7, 3.9, 4.6, 11.4, 13.3, 32.69, 7, 3.9, 4.6, 11.4, 13.3, 32.69, 7, 3.9, 4.6, 11.4, 13.3, 32.69), 
                      WUA = c(WUA_Tanno_2012_Baetis_7, WUA_Tanno_2012_Baetis_3, WUA_Tanno_2012_Baetis_4, WUA_Tanno_2012_Baetis_11, WUA_Tanno_2012_Baetis_13, WUA_Tanno_2012_Baetis_32, WUA_Tanno_2012_Rhithrogena_7,WUA_Tanno_2012_Rhithrogena_3, WUA_Tanno_2012_Rhithrogena_4, WUA_Tanno_2012_Rhithrogena_11, WUA_Tanno_2012_Rhithrogena_13, WUA_Tanno_2012_Rhithrogena_32, WUA_HABBY_Rhithrogena_7, WUA_HABBY_Rhithrogena_3, WUA_HABBY_Rhithrogena_4, WUA_HABBY_Rhithrogena_11, WUA_HABBY_Rhithrogena_13, WUA_HABBY_Rhithrogena_32), 
                      HHS = c(HHS_Tanno_2012_Baetis_7, HHS_Tanno_2012_Baetis_3, HHS_Tanno_2012_Baetis_4, HHS_Tanno_2012_Baetis_11, HHS_Tanno_2012_Baetis_13, HHS_Tanno_2012_Baetis_32, HHS_Tanno_2012_Rhithrogena_7, HHS_Tanno_2012_Rhithrogena_3, HHS_Tanno_2012_Rhithrogena_4, HHS_Tanno_2012_Rhithrogena_11, HHS_Tanno_2012_Rhithrogena_13, HHS_Tanno_2012_Rhithrogena_32, HHS_HABBY_Rhithrogena_7, HHS_HABBY_Rhithrogena_3, HHS_HABBY_Rhithrogena_4, HHS_HABBY_Rhithrogena_11, HHS_HABBY_Rhithrogena_13, HHS_HABBY_Rhithrogena_32),
                      WA_tot = c(WA_tot_Tanno_2012_Baetis_7, WA_tot_Tanno_2012_Baetis_3, WA_tot_Tanno_2012_Baetis_4, WA_tot_Tanno_2012_Baetis_11, WA_tot_Tanno_2012_Baetis_13, WA_tot_Tanno_2012_Baetis_32, WA_tot_Tanno_2012_Rhithrogena_7, WA_tot_Tanno_2012_Rhithrogena_3, WA_tot_Tanno_2012_Rhithrogena_4, WA_tot_Tanno_2012_Rhithrogena_11, WA_tot_Tanno_2012_Rhithrogena_13, WA_tot_Tanno_2012_Rhithrogena_32, WA_tot_HABBY_Rhithrogena_7, WA_tot_HABBY_Rhithrogena_3, WA_tot_HABBY_Rhithrogena_4, WA_tot_HABBY_Rhithrogena_11, WA_tot_HABBY_Rhithrogena_13, WA_tot_HABBY_Rhithrogena_32))

write.csv(results, file = "results_statistics/Results_Multivariate_Habitat_Model.csv", row.names = FALSE)
```



# 2a. Veränderung Habitatverfügbarkeit in Abhängigkeit versch. Abflüsse 
```{r}
# make data frame for plotting
library(readr)
library(ggplot2)
WUA_HHS <- read_delim("results_statistics/Results_Multivariate_Habitat_Model.csv")

# select all WUA's for plotting
WUA_Tanno_2012_Baetis <- WUA_HHS[ c(0:6), c(1:3)]
WUA_Tanno_2012_Rhithrogena <- WUA_HHS[ c(0, 7:12), c(1:3)]
WUA_HABBY_Rhithrogena <- WUA_HHS[ c(0, 13:18), c(1:3)]

# select all HHS's for plotting
HHS_Tanno_2012_Baetis <- WUA_HHS[ c(0:6), c(1,2,4)]
HHS_Tanno_2012_Rhithrogena <- WUA_HHS[ c(0, 7:12), c(1,2,4)]
HHS_HABBY_Rhithrogena <- WUA_HHS[ c(0, 13:18), c(1,2,4)]

# select all WA_tot's for plotting
WA_Tanno_2012_Baetis <- WUA_HHS[ c(0:6), c(1,2,5)]
WA_Tanno_2012_Rhithrogena <- WUA_HHS[ c(0, 7:12), c(1,2,5)]
WA_HABBY_Rhithrogena <- WUA_HHS[ c(0, 13:18), c(1,2,5)]


# plot results
# WUA results
WUA_results <- ggplot() +
  geom_line(data = WUA_Tanno_2012_Baetis, aes(Discharge, WUA, color = "WUA_Tanno_Baetis")) +
  geom_point(data = WUA_Tanno_2012_Baetis, aes(Discharge, WUA, color = "WUA_Tanno_Baetis")) +
  geom_line(data = WUA_Tanno_2012_Rhithrogena, aes(Discharge, WUA, color = "WUA_Tanno_Rhithrogena")) +
  geom_point(data = WUA_Tanno_2012_Rhithrogena, aes(Discharge, WUA, color = "WUA_Tanno_Rhithrogena")) +
   geom_line(data = WUA_HABBY_Rhithrogena, aes(Discharge, WUA, color = "HABBY_Rhithrogena")) +
  geom_point(data = WUA_HABBY_Rhithrogena, aes(Discharge, WUA, color = "HABBY_Rhithrogena")) +
   scale_color_manual(name = "Macroinvertebrates",
                     values = c("WUA_Tanno_Baetis" = "violet", "WUA_Tanno_Rhithrogena" = "lightblue", "HABBY_Rhithrogena" = "green" ), 
                     labels = c("Tanno 2012 Baetis sp.", "Tanno 2012 Rhithrogena", "HABBY Rhithrogena eaton larva")) +
  labs(title = "Comparing WUA of different macroinvertebrates and literature", x = "Discharge [m3/s]", y = "Weighted usable area (WUA)")

# HHS results
HHS_results <- ggplot() +
  geom_line(data = HHS_Tanno_2012_Baetis, aes(Discharge, HHS, color = "HHS_Tanno_Baetis")) +
  geom_point(data = HHS_Tanno_2012_Baetis, aes(Discharge, HHS, color = "HHS_Tanno_Baetis")) +
  geom_line(data = HHS_Tanno_2012_Rhithrogena, aes(Discharge, HHS, color = "HHS_Tanno_Rhithrogena")) +
  geom_point(data = HHS_Tanno_2012_Rhithrogena, aes(Discharge, HHS, color = "HHS_Tanno_Rhithrogena")) +
   geom_line(data = HHS_HABBY_Rhithrogena, aes(Discharge, HHS, color = "HABBY_Rhithrogena")) +
  geom_point(data = HHS_HABBY_Rhithrogena, aes(Discharge, HHS, color = "HABBY_Rhithrogena")) +
   scale_color_manual(name = "Macroinvertebrates",
                     values = c("HHS_Tanno_Baetis" = "violet", "HHS_Tanno_Rhithrogena" = "lightblue", "HABBY_Rhithrogena" = "green" ), 
                     labels = c("Tanno 2012 Baetis sp.", "Tanno 2012 Rhithrogena", "HABBY Rhithrogena eaton larva")) +
  labs(title = "Comparing HHS of different macroinvertebrates and literature", x = "Discharge [m3/s]", y = "HHS")

# WA tot results
WA_tot_results <- ggplot() +
  geom_line(data = WA_Tanno_2012_Baetis, aes(Discharge, WA_tot), col = "blue") +
  geom_point(data = WA_Tanno_2012_Baetis, aes(Discharge, WA_tot), col = "blue") +
  labs(title = "Comparing total wetted area at different discharges", x = "Discharge [m3/s]", y = "Wetted Area (WA_tot)")
```

```{r}
# save plots into .png
# set the dimensions of the quadrat
quadrat_width <- 15 # in cm
quadrat_height <- 10 # in cm

# WUA 
ggsave(filename = "results_statistics/WUA_results.png",plot = WUA_results, width = quadrat_width, height = quadrat_height, units = "cm")


# HHS
ggsave(filename = "results_statistics/HHS_results.png",plot = HHS_results, width = quadrat_width, height = quadrat_height, units = "cm")

# WA_tot
ggsave(filename = "results_statistics/WA_tot_results.png",plot = WA_tot_results, width = quadrat_width, height = quadrat_height, units = "cm")
```






